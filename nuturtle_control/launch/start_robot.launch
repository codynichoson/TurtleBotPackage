<launch>

    <arg name="cmd_src"        default="circle"/>
    <arg name="robot"          default="nusim" />
    <arg name="nusim_rate"     default="500"/>
    <arg name="frequency"      default="100"/>

    <remap from="/red/joint_states" to="/joint_states"/>
    <remap from="/red/wheel_cmd" to="/wheel_cmd"/>
    <remap from="/red/sensor_data" to="/sensor_data"/>

    <param name="odom_id" type="string" value="odom"/>
    <param name="body_id" type="string" value="blue_base_footprint"/>
    <param name="rate" type="" value="100"/>

    <rosparam file="$(find nuturtle_description)/config/diff_params.yaml" ns="nusim"/>
    <node name="circle" pkg="nuturtle_control" type="circle" if="$(eval arg('cmd_src')=='circle')">
        <param name="~frequency" value="$(arg frequency)"/>
    </node>
    <include file="$(find turtlebot3_teleop)/launch/turtlebot3_teleop_key.launch" if="$(eval arg('cmd_src')=='teleop')"/>
    

    <!-- Loading stuff for blue odometry robot in Rviz -->
    <param name="/blue/robot_description" command="$(find xacro)/xacro '$(find nuturtle_description)/urdf/turtlebot3_burger.urdf.xacro' color:=blue"/>
    <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" ns="blue"/>
    <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher" ns="blue"/>
    <node pkg="tf2_ros" type="static_transform_publisher" name="world_to_odom" args="0 0 0 0 0 0 1 world odom" />

    <!-- When launching real robot -->
    <group if="$(eval arg('robot')!='nusim')">
        <node name="turtle_interface" pkg="nuturtle_control" type="turtle_interface" machine="turtlebot"/>
        <node name="odometry" pkg="nuturtle_control" type="odometry" machine="turtlebot"/>
        <include file="$(find nuturtle_control)/launch/basic_remote.launch" pass_all_args="true"/>
        <node pkg="rviz" type="rviz" name="rviz" required="true" args="-f world -d $(find nuturtle_control)/config/nuturtle_control_real.rviz"/>
    </group>

    <!-- When launching simulation -->
    <group if="$(eval arg('robot')=='nusim')">
        <node name="nusim" pkg="nusim" type="nusim_node">
            <param name="~rate" value="$(arg nusim_rate)"/>
        </node>
        <node name="turtle_interface" pkg="nuturtle_control" type="turtle_interface"/>
        <node name="odometry" pkg="nuturtle_control" type="odometry"/>
        <rosparam file="$(find nusim)/config/basic_world.yaml"/>
        <param name="/red/robot_description" command="$(find xacro)/xacro '$(find nuturtle_description)/urdf/turtlebot3_burger.urdf.xacro' color:=red"/>
        <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" ns="red"/>
        <node pkg="rviz" type="rviz" name="rviz" required="true" args="-f world -d $(find nuturtle_control)/config/nuturtle_control.rviz"/>
    </group>

</launch>